[Test]
comp.c: 	 	Conf("gcc", "C Compiler")
comp.cxx: 		Conf("g++", "C++ Compiler")
comp.insieme: 	Conf("${CMAKE_BINARY_DIR}/code/driver/main", "InsiemeC")

SRC_DIR: 	${CMAKE_SOURCE_DIR}
BIN_DIR: 	${CMAKE_BINARY_DIR}
SMP_HEADER:	%(SRC_DIR)s/code/simple_backend/include/insieme/simple_backend/runtime
SMP_BUILD:  %(BIN_DIR)s/code/simple_backend/

act.sema: 	Conf(Flag("-S"), "Sema")
act.ir: 	Conf(OutFileFlag("--dump-ir", "ir"))
act.cfg: 	Conf(OutFileFlag("--dump-cfg", "cfg"))
act.smp: 	Conf(Flag("-b pthread"), "Simple Backend")
act.seq:	Conf(Flag("-b seq"), "Seq. Backend")
act.run:	Conf(Flag("-b run"), "Run. Backend")
act.ocl:	Conf(Flag("-b ocl"), "Ocl Backend")

front.insieme: %(comp.insieme)s + Conf(Flag("--std=c99 -I."))

# LIST of INSIEME BACKENDS
back.gcc:	Conf([ 
					Flag("-fshow-column"), 
					Flag("-Wall"), 
					Flag("-pipe"),
					Flag("-I.")
				])
back.cc: 	%(comp.c)s + %(back.gcc)s + Conf(Flag("-std=c99"))
back.cxx:	%(comp.cxx)s + %(back.gcc)s + Conf(Flag("-std=c++0x")) 
back.c.opt: Conf(Flag("-O3"))
back.smp:	%(back.cc)s +  
				Conf([ 
						Flag("-I%(SMP_HEADER)s"),
						Flag("-linsieme_simple_backend_runtime"),
						Flag("-L%(SMP_BUILD)s")
					 ], "SMB")
back.seq: 	%(back.cc)s + Conf(Flag("-lm"), "SEQ")
back.run:	%(back.cc)s +  
				Conf([
						Flag('-I%(SRC_DIR)s/code/runtime/include'),
						Flag('-D_XOPEN_SOURCE=700'),
						Flag('-D_GNU_SOURCE'),
						Flag('-ldl')
					], "RUN")
back.ocl: %(back.cc)s + %(back.run)s + Conf(Flag('-lOpenCL'), "OCL")

# LIST OF PASSES (it's important that passes names begins with the pass keyword)
pass.0.stdc: 	Pass(None, None, %(back.cc)s, 'ref')
pass.1.stdcxx:	Pass(None, None, %(back.cxx)s, 'ref')
pass.2.sema: 	Pass(%(front.insieme)s + %(act.sema)s + %(act.ir)s + %(act.cfg)s)
pass.3.smp:		Pass(%(front.insieme)s + %(act.smp)s, 'insieme.smp.c', 
					 %(back.smp)s+%(back.c.opt)s, 'smp.test'
					) 
pass.4.seq:   	Pass(%(front.insieme)s + %(act.seq)s, 'insieme.seq.c', %(back.seq)s + %(back.c.opt)s, 'seq.test')
pass.5.run:		Pass(%(front.insieme)s + %(act.run)s, 'insieme.run.c', %(back.run)s + %(back.c.opt)s, 'run.test')
pass.6.ocl:		Pass(%(front.insieme)s + %(act.ocl)s, 'insieme.ocl.c', %(back.ocl)s + %(back.c.opt)s, 'ocl.test')

